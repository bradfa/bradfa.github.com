---
layout: post
title: Debian 6 amd64 on HP Elitebook Workstation 8560w
date: 2011-11-23
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
I got my new laptop this week, it's a spiffy HP Elitebook Workstation 8560w.  Dual core i7 at 2.7 GHz, 8 GB ram, SSD, NVIDIA Quadro 1000M, all good stuff.<br /><br />I've installed Debian Squeeze and found that I needed to do a few tweaks beyond what I expected in order to get the graphics and wifi working.  First, get the wifi working, then deal with graphics.<br /><br />You'll need to enable squeeze-backports.  Follow <a href="http://http://backports-master.debian.org/Instructions/">the directions</a>.  Install the linux-kernel-2.6.38, linux-headers-2.6.38, and firmware-iwlwifi packages.  Then modify your /etc/default/grub file, the 7th line should look like this:<br /><br />GRUB_CMDLINE_LINUX_DEFAULT="nouveau.modeset=0 quiet"<br /><br />Run update-grub2 to make the change permanent.<br /><br />Now you can reboot and you should be running the 2.6.38 kernel.  If you don't pass the nouveau.modeset line to your kernel when booting, it will hang.  Mine likes to hang just after "hp_accel: driver loaded" which isn't very helpful.<br /><br />Now, go grab the NVIDIA drivers from nvidia.com.  Make sure you have gcc-4.4 installed.  Go to a terminal with cmd-alt-F1 and log in as root.  "killall gdm3" to shutdown X.  Now run the NVIDIA installer.<br /><br />Whamo!  After another reboot you should be up and running with both wifi and graphics!<br />Sadly, with the stock kernel, the webcam worked awesomely.  With 2.6.38, it's broken.  If I determine the root cause I'll update. <br /><br />UPDATE 20111123 5:30pm: To get webcam working again, don't use Camorama.  Use something like cheese.  Camorama wants the camera to be located at /dev/video0, it's not there any more.  Things like Skype and cheese find the webcam with no issue.  I'm happy! :) <br /><br />UPDATE 20111126 10:00am: In order to get suspend working again with kernels newer than 2.6.35, you may need to blacklist a few modules, namely "firewire_ohci" and "firewire_core".  Put the below in a file named /etc/modprobe.d/8560w-blacklist.conf, run  and give the laptop a reboot.  I've included here the pcspkr module as well to make that stupid beep go away ;)  Now I have (I believe) all the hardware working on my 8560w except Firewire (I don't have any Firewire devices so I'm not that upset).  Thanks go out to an Ubuntu <a href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/748994">bug report</a>, scroll down to <a href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/748994/comments/50">#50</a>. <br /><br /><script src="https://gist.github.com/1395828.js?file=8560w-blacklist.conf"></script><br /><br />UPDATE 20111129 3:00pm: If you'd like ExpressCard hot plugging to work, you need to add "pciehp" to your /etc/modules and "options pciehp pciehp_force=1" to a new file called /etc/modprobe.d/pciehp.  Both those are to be added without the quotes.  Hat tip to Mark Lord on the LKML, <a href="https://lkml.org/lkml/2009/8/27/158">part 1</a> and <a href="https://lkml.org/lkml/2009/8/27/165">part 2</a>.<br /><br />UPDATE 20111208 7:00am: I'm going to recommend against encrypted LVM on an SSD with Debian Squeeze.  The SSD in my 8560w says it supports TRIM but I'm having a hard time verifying that it's working, either automatically or manually.  I have "discard" in my fstab and the 2.6.38 kernel supports it.<br />I'm thinking the way to go about encrypting important info is to just encrypt the directories I care about rather than the whole file system.  I might do a backup, reformat, and restore, then enable just directory level encryption where needed (for example, I don't really care if my /usr directory is encrypted since it just has Debian sourced programs installed).</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Andrew</div>
<div class='content'>
Neal,<br />Sorry, but I don&#39;t have much experience running Ubuntu on my 8560w, I&#39;ve stuck with Debian and run Ubuntu and Windows in VMs.  I know there have been other complaints of similar issues (including one Ubuntu bug report where it looks like you&#39;ve already mentioned this).  I wouldn&#39;t think SATA issues would be related to the graphics driver, but those messages might just be the last things written to the screen and not be indicative of the actual issue.<br />Can you try installing Ubuntu Server and booting it?  Server shouldn&#39;t install a graphical desktop by default.  At least if you can get that far, it&#39;s not a core issue but can be narrowed down to the graphics or other sub-system.<br />Good luck!</div>
</div>
<div class='comment'>
<div class='author'>NealTNJ</div>
<div class='content'>
Hi, i recently brought a HP Elitebook 8560w and its awesome. However, every time i try to boot linux ubuntu  and backtrack 5 off a USB external hard drive . I receive this error <br />ata 4: sata link down sstatus 0 scontrol 300<br />ata 5: sata link down sstatus 0 scontrol 300<br />ata 6: sata link down sstatus 0 scontrol 300. This error still persists even after updating grub.cfg with the commands nouveau.modeset=0 quiet. After reading your blog, I feel that your the person to ask.</div>
</div>
</div>
